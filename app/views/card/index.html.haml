.body
  =render "users/mainheader"
  .main
    .main-box
      =render "users/sidebar"
      .card-info
        .credit_box
          .box_top
            支払い方法
        - if @card.blank?
          .box_main
            .box_content
              .box_content__show
                クレジットカード一覧
              .box_content__add
                .add-content
                  =link_to new_user_card_path, class: "add-content__link" do
                    = icon('fas', 'credit-card', class: 'add-content__icon')
                    クレジットカードを追加する
            .box_footer
              =link_to "#", class: "box_footer__link" do
                %span 支払い方法について 
                = icon('fas', 'chevron-right')
        - else
          .main-head
            .buy-user-info2
              .box_main
                .box_content
                  %h3 
                    クレジットカード一覧
                  .box_show
                    .show_left
                      .show_left__icon
                      = image_tag("/images/jcb.svg", alt: "jcb", height: "20", width: "26")
                      .show_left__info
                        = "**** **** **** " + @default_card_information.last4
                      .show_left__expire
                        - exp_month = @default_card_information.exp_month.to_s
                        - exp_year = @default_card_information.exp_year.to_s.slice(2,3)
                        = exp_month + " / " + exp_year
                      .show_right
                        = form_tag"/users/#{current_user.id}/card/3", method: :delete, id: 'charge-form',  name: "inputForm" do
                          %input{ type: "hidden", name: "card_id", value: "", class: "show_right__delete" }
                          %button.show_right__delete
                            削除する
                .box_footer
                  =link_to "#", class: "box_footer__link" do
                    %span 支払い方法について 
                    = icon('fas', 'chevron-right')
  =render "users/footer-imag"
  =render "layouts/mainfooter"

:javascript
  document.addEventListener(
  "DOMContentLoaded", (e) => {
    Payjp.setPublicKey("pk_test_ef63b463bb0dce2a127045de");
    const btn = document.getElementById('token_submit'); //IDがtoken_submitの場合に取得されます
    btn.addEventListener("click", (e) => {//ボタンが押されたときに作動します
      e.preventDefault();//ボタンを一旦無効化します

      //カード情報生成
      const card = {
        number: document.getElementById("card_number").value,
        cvc: document.getElementById("cvc").value,
        exp_month: document.getElementById("exp_month").value,
        exp_year: document.getElementById("exp_year").value
      }; //入力されたデータを取得します。

      //トークン生成
      Payjp.createToken(card, (status, response) => {
        if (status === 200) { //成功した場合
          $("#card_number").removeAttr("name");
          $("#cvc").removeAttr("name");
          $("#exp_month").removeAttr("name");
          $("#exp_year").removeAttr("name"); //カード情報を自分のサーバにpostせず削除します
          $("#card_token").append(
            $('<input type="hidden" name="payjp-token">').val(response.id)
          ); //トークンを送信できるように隠しタグを生成
          document.inputForm.submit();
          alert("登録が完了しました"); //確認用
        } else {
          alert("カード情報が正しくありません。"); //確認用
        }
      });
    });
  },false);